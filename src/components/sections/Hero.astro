---
import ButtonLink from '../primitives/ButtonLink.astro';

/**
 * Hero Section Component
 *
 * Supports two layout variants:
 * - 'centered': Content centered with optional image/video below
 * - 'default': Two-column layout with content on left, media on right
 *
 * Features:
 * - Optional video background with overlay
 * - Optional image or video content
 * - Responsive design
 * - CTA button support
 */
interface Props {
  title: string;
  subtitle?: string;
  cta?: {
    label: string;
    href: string;
    variant?: 'primary' | 'secondary';
  };
  image?: {
    src: string;
    alt: string;
  };
  video?: {
    src: string;
    poster?: string;
    autoplay?: boolean;
    loop?: boolean;
    muted?: boolean;
  };
  videoBackground?: {
    src: string;
    poster?: string;
    overlay?: boolean;
    overlayOpacity?: 'light' | 'medium' | 'dark';
  };
  variant?: 'default' | 'centered';
  background?: string;
  class?: string;
}

const {
  title,
  subtitle,
  cta,
  image,
  video,
  videoBackground,
  variant = 'default',
  background,
  class: className = '',
} = Astro.props;

const overlayOpacityClasses = {
  light: 'bg-black/30',
  medium: 'bg-black/50',
  dark: 'bg-black/70',
};

const sectionClasses = [
  'relative py-16 md:py-24 lg:py-32',
  !videoBackground && !background ? 'bg-white' : '',
  className,
].filter(Boolean).join(' ');

const sectionStyles = background && !videoBackground ? `background: ${background};` : '';

const isCentered = variant === 'centered';
const contentClasses = isCentered ? 'text-center mx-auto max-w-3xl' : '';
const hasVideoBackground = !!videoBackground;
const textColorClass = hasVideoBackground ? 'text-white' : 'text-brand-primary';
const subtitleColorClass = hasVideoBackground ? 'text-gray-100' : 'text-gray-600';
---

<section class={sectionClasses} style={sectionStyles}>
  {/* Video Background */}
  {videoBackground && (
    <>
      <video
        autoplay
        loop
        muted
        playsinline
        poster={videoBackground.poster}
        class="absolute inset-0 w-full h-full object-cover z-0"
      >
        <source src={videoBackground.src} type="video/mp4" />
      </video>

      {/* Overlay */}
      {videoBackground.overlay !== false && (
        <div
          class={`absolute inset-0 z-0 ${
            overlayOpacityClasses[videoBackground.overlayOpacity || 'medium']
          }`}
          aria-hidden="true"
        ></div>
      )}
    </>
  )}

  <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl relative z-10">
    {variant === 'centered' ? (
      <div class={contentClasses}>
        <h1 class={`text-4xl sm:text-5xl lg:text-6xl font-bold font-heading ${textColorClass} mb-4 lg:mb-6`}>
          {title}
        </h1>

        {subtitle && (
          <p class={`text-lg sm:text-xl lg:text-2xl ${subtitleColorClass} mb-6 lg:mb-8`}>
            {subtitle}
          </p>
        )}

        {cta && (
          <div class="flex flex-wrap gap-4 justify-center">
            <ButtonLink
              href={cta.href}
              variant={cta.variant || 'primary'}
              size="lg"
            >
              {cta.label}
            </ButtonLink>
          </div>
        )}

        {image && (
          <div class="mt-8 lg:mt-12">
            <img
              src={image.src}
              alt={image.alt}
              class="w-full h-auto rounded-lg shadow-xl"
              loading="lazy"
              decoding="async"
            />
          </div>
        )}

        {video && (
          <div class="mt-8 lg:mt-12">
            <video
              poster={video.poster}
              autoplay={video.autoplay}
              loop={video.loop}
              muted={video.muted}
              controls
              class="w-full h-auto rounded-lg shadow-xl"
            >
              <source src={video.src} type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        )}
      </div>
    ) : (
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
        <div>
          <h1 class={`text-4xl sm:text-5xl lg:text-6xl font-bold font-heading ${textColorClass} mb-4 lg:mb-6`}>
            {title}
          </h1>

          {subtitle && (
            <p class={`text-lg sm:text-xl lg:text-2xl ${subtitleColorClass} mb-6 lg:mb-8`}>
              {subtitle}
            </p>
          )}

          {cta && (
            <div class="flex flex-wrap gap-4">
              <ButtonLink
                href={cta.href}
                variant={cta.variant || 'primary'}
                size="lg"
              >
                {cta.label}
              </ButtonLink>
            </div>
          )}
        </div>

        {image && (
          <div class="order-first lg:order-last">
            <img
              src={image.src}
              alt={image.alt}
              class="w-full h-auto rounded-lg shadow-xl"
              loading="lazy"
              decoding="async"
            />
          </div>
        )}

        {video && (
          <div class="order-first lg:order-last">
            <video
              poster={video.poster}
              autoplay={video.autoplay}
              loop={video.loop}
              muted={video.muted}
              controls
              class="w-full h-auto rounded-lg shadow-xl"
            >
              <source src={video.src} type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        )}
      </div>
    )}
  </div>
</section>
