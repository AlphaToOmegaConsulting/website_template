---
interface Props {
  title: string;
  subtitle?: string;
  events: Array<{
    date: string;
    title: string;
    description?: string;
    icon?: string;
    image?: {
      src: string;
      alt: string;
    };
    link?: {
      href: string;
      label?: string;
    };
  }>;
  layout?: 'vertical' | 'alternating';
  class?: string;
}

const {
  title,
  subtitle,
  events,
  layout = 'vertical',
  class: className = '',
} = Astro.props;

const sectionClasses = [
  'py-16 md:py-24 bg-white',
  className,
].filter(Boolean).join(' ');
---

<section class={sectionClasses}>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
    <div class="text-center mb-12 lg:mb-16">
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold font-heading text-brand-primary mb-4">
        {title}
      </h2>

      {subtitle && (
        <p class="text-lg sm:text-xl text-gray-600 max-w-3xl mx-auto">
          {subtitle}
        </p>
      )}
    </div>

    <div class={layout === 'alternating' ? 'max-w-5xl mx-auto' : 'max-w-4xl mx-auto'}>
      <div class="relative">
        {/* Timeline line */}
        <div
          class={`absolute ${
            layout === 'alternating'
              ? 'left-1/2 -translate-x-1/2 hidden md:block'
              : 'left-4 md:left-8'
          } top-0 bottom-0 w-0.5 bg-gray-200`}
          aria-hidden="true"
        ></div>

        {/* Timeline events */}
        <div class="space-y-12">
          {events.map((event, index) => (
            <div
              class={`relative ${
                layout === 'alternating' && index % 2 === 1
                  ? 'md:grid md:grid-cols-2 md:gap-8 md:flex-row-reverse'
                  : layout === 'alternating'
                  ? 'md:grid md:grid-cols-2 md:gap-8'
                  : 'flex gap-6 md:gap-8'
              }`}
            >
              {/* Date/Icon dot */}
              <div
                class={`${
                  layout === 'alternating'
                    ? 'hidden md:flex absolute left-1/2 -translate-x-1/2 items-center justify-center'
                    : 'flex-shrink-0'
                }`}
              >
                <div class="flex items-center justify-center w-8 h-8 md:w-12 md:h-12 rounded-full bg-brand-accent text-white shadow-md relative z-10">
                  {event.icon ? (
                    <span class="text-lg md:text-xl">{event.icon}</span>
                  ) : (
                    <svg
                      class="w-4 h-4 md:w-6 md:h-6"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                  )}
                </div>
              </div>

              {/* Empty space for alternating layout */}
              {layout === 'alternating' && index % 2 === 1 && (
                <div class="hidden md:block"></div>
              )}

              {/* Event content */}
              <div
                class={`flex-1 ${
                  layout === 'alternating'
                    ? index % 2 === 1
                      ? 'md:text-right'
                      : ''
                    : 'pl-4 md:pl-0'
                }`}
              >
                <div class="bg-gray-50 rounded-lg p-6 md:p-8 shadow-sm border border-gray-200">
                  <div class={`text-sm font-semibold text-brand-accent mb-2 ${
                    layout === 'alternating' && index % 2 === 1 ? 'md:text-right' : ''
                  }`}>
                    {event.date}
                  </div>

                  <h3 class={`text-xl md:text-2xl font-bold font-heading text-gray-900 mb-3 ${
                    layout === 'alternating' && index % 2 === 1 ? 'md:text-right' : ''
                  }`}>
                    {event.title}
                  </h3>

                  {event.description && (
                    <p class={`text-gray-700 leading-relaxed mb-4 ${
                      layout === 'alternating' && index % 2 === 1 ? 'md:text-right' : ''
                    }`}>
                      {event.description}
                    </p>
                  )}

                  {event.image && (
                    <div class="mb-4 rounded-lg overflow-hidden">
                      <img
                        src={event.image.src}
                        alt={event.image.alt}
                        class="w-full h-auto"
                        loading="lazy"
                        decoding="async"
                      />
                    </div>
                  )}

                  {event.link && (
                    <a
                      href={event.link.href}
                      class={`inline-flex items-center gap-2 text-brand-accent font-semibold hover:underline ${
                        layout === 'alternating' && index % 2 === 1 ? 'md:flex-row-reverse' : ''
                      }`}
                    >
                      {event.link.label || 'Learn more'}
                      <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        aria-hidden="true"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5l7 7-7 7"
                        />
                      </svg>
                    </a>
                  )}
                </div>
              </div>

              {/* Empty space for alternating layout (other side) */}
              {layout === 'alternating' && index % 2 === 0 && (
                <div class="hidden md:block"></div>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>
