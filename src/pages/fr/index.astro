---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/sections/Hero.astro';
import About from '../../components/sections/About.astro';
import Features from '../../components/sections/Features.astro';
import Events from '../../components/sections/Events.astro';
import CTA from '../../components/sections/CTA.astro';
import { siteConfig } from '@/config/site';
import { getTranslations } from '@/config/i18n';

// Fetch content from Content Collections
const allSections = await getCollection('sections');

// Filter sections for home page (French version)
const homeSections = allSections.filter(section =>
  section.id.includes('home') && !section.id.includes('home-en')
);

// Sort sections by order
const sortedSections = homeSections
  .filter(section => section.data.visible)
  .sort((a, b) => a.data.order - b.data.order);

// Get section data by type
const getSectionData = (type: string) => {
  return sortedSections.find(section => section.data.type === type)?.data.data;
};

const heroData = getSectionData('hero');
const aboutData = getSectionData('about');
const featuresData = getSectionData('features');
const ctaData = getSectionData('cta');

const t = getTranslations('fr');

// Page metadata
const pageTitle = `${t.nav.home} - ${siteConfig.name}`;
const pageDescription = siteConfig.description;
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  lang="fr"
  alternateUrls={{
    fr: '/fr/',
    en: '/en/'
  }}
>
  {heroData && (
    <Hero
      title={heroData.title}
      subtitle={heroData.subtitle}
      cta={heroData.cta}
      image={heroData.image}
      background={heroData.background}
    />
  )}

  {aboutData && (
    <About
      title={aboutData.title}
      content={aboutData.content}
      image={aboutData.image}
      stats={aboutData.stats}
    />
  )}

  {featuresData && (
    <Features
      title={featuresData.title}
      subtitle={featuresData.subtitle}
      features={featuresData.features}
      layout={featuresData.layout}
      columns={featuresData.columns}
    />
  )}

  <Events
    title={t.events.upcoming}
    displayMode="upcoming"
    limit={3}
    lang="fr"
  />

  {ctaData && (
    <CTA
      title={ctaData.title}
      description={ctaData.description}
      primaryCta={ctaData.primaryCta}
      secondaryCta={ctaData.secondaryCta}
      background={ctaData.background}
    />
  )}
</BaseLayout>
