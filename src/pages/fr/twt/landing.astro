---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Hero from '../../../components/sections/Hero.astro';
import About from '../../../components/sections/About.astro';
import Features from '../../../components/sections/Features.astro';
import Events from '../../../components/sections/Events.astro';
import CTA from '../../../components/sections/CTA.astro';
// Fetch content from Content Collections
const allSections = await getCollection('sections');
const allEvents = await getCollection('events', ({ data }) => {
  return data.lang === 'fr';
});

// Filter sections for TWT landing page (by filename pattern)
const twtSections = allSections.filter(section => 
  section.id.includes('twt-landing')
);

// Sort sections by order
const sortedSections = twtSections
  .filter(section => section.data.visible)
  .sort((a, b) => a.data.order - b.data.order);

// Get section data by type
const getSectionData = (type: string) => {
  return sortedSections.find(section => section.data.type === type)?.data.data;
};

const heroData = getSectionData('hero');
const aboutData = getSectionData('about');
const featuresData = getSectionData('features');
const eventsData = getSectionData('events');
const ctaData = getSectionData('cta');

// Transform events for the Events component
const transformedEvents = allEvents.map(event => ({
  id: event.id,
  title: event.data.title,
  date: event.data.date,
  location: event.data.location,
  description: event.data.description,
  link: event.data.registrationUrl,
}));

// Page metadata
const pageTitle = 'Tech Women Together - Landing';
const pageDescription = 'Rejoignez la communauté Tech Women Together pour connecter, apprendre et grandir ensemble dans le domaine de la technologie.';
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  lang="fr"
  alternateUrls={{
    fr: '/fr/twt/landing',
    en: '/en/twt/landing'
  }}
>
  {heroData && (
    <Hero
      title={heroData.title}
      subtitle={heroData.subtitle}
      cta={heroData.cta}
      image={heroData.image}
      background={heroData.background}
    />
  )}

  {aboutData && (
    <About
      title={aboutData.title}
      content={aboutData.content}
      image={aboutData.image}
      stats={aboutData.stats}
    />
  )}

  {featuresData && (
    <Features
      title={featuresData.title}
      subtitle={featuresData.subtitle}
      features={featuresData.features}
      layout={featuresData.layout}
      columns={featuresData.columns}
    />
  )}

  {eventsData && transformedEvents.length > 0 && (
    <Events
      title={eventsData.title || 'Événements'}
      events={transformedEvents}
      displayMode={eventsData.displayMode || 'upcoming'}
      limit={eventsData.limit}
    />
  )}

  {ctaData && (
    <CTA
      title={ctaData.title}
      description={ctaData.description}
      primaryCta={ctaData.primaryCta}
      secondaryCta={ctaData.secondaryCta}
      background={ctaData.background}
    />
  )}
</BaseLayout>
