---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { buildUrl } from '@/utils/url';
import Hero from '@/components/sections/Hero.astro';
import About from '@/components/sections/About.astro';
import CTA from '@/components/sections/CTA.astro';
import Prose from '@/components/Prose.astro';

const lang = 'fr';
const slug = 'add-section';

// Load page content
const pageEntry = await getEntry('pages', `${lang}/guides-${slug}`);

// Load sections for this guide
const allSections = await getCollection('sections');
const guideSections = allSections.filter(section => 
  section.id.includes(`guides-${slug}`) && 
  (lang === 'fr' ? !section.id.includes('-en') : section.id.includes('-en'))
);

const sortedSections = guideSections
  .filter(section => section.data.visible)
  .sort((a, b) => a.data.order - b.data.order);

const getSectionData = (type: string) => {
  return sortedSections.find(section => section.data.type === type)?.data.data;
};

const heroData = getSectionData('hero');
const aboutData = getSectionData('about');
const ctaData = getSectionData('cta');

const { Content } = await pageEntry.render();
---

<BaseLayout
  title={pageEntry.data.title}
  description={pageEntry.data.description}
  lang={lang}
  alternateUrls={{
    fr: buildUrl(`/fr/guides/${slug}`),
    en: buildUrl(`/en/guides/${slug}`)
  }}
>
  {heroData && <Hero {...heroData} />}
  
  <div class="container mx-auto px-4 py-12 max-w-4xl">
    <Prose>
      <Content />
    </Prose>
  </div>
  
  {aboutData && <About {...aboutData} />}
  {ctaData && <CTA {...ctaData} />}
</BaseLayout>
