---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/sections/Hero.astro';
import About from '../../components/sections/About.astro';
import Features from '../../components/sections/Features.astro';
import CTA from '../../components/sections/CTA.astro';

// Fetch page metadata
const pageData = await getEntry('pages', 'en/home');

// Fetch content from Content Collections
const allSections = await getCollection('sections');

// Filter sections for home page (English version)
const homeSections = allSections.filter(section =>
  section.id.includes('home-en')
);

// Sort sections by order
const sortedSections = homeSections
  .filter(section => section.data.visible)
  .sort((a, b) => a.data.order - b.data.order);

// Get section data by type
const getSectionData = (type: string) => {
  return sortedSections.find(section => section.data.type === type)?.data.data;
};

const heroData = getSectionData('hero');
const featuresData = getSectionData('features');
const aboutData = getSectionData('about');
const ctaData = getSectionData('cta');
---

<BaseLayout
  title={pageData.data.title}
  description={pageData.data.description}
  lang="en"
  alternateUrls={{
    fr: '/fr/',
    en: '/en/'
  }}
>
  {heroData && (
    <Hero
      title={heroData.title}
      subtitle={heroData.subtitle}
      cta={heroData.cta}
      variant={heroData.variant}
    />
  )}

  {featuresData && (
    <Features
      title={featuresData.title}
      subtitle={featuresData.subtitle}
      features={featuresData.features}
      layout={featuresData.layout}
      columns={featuresData.columns}
    />
  )}

  {aboutData && (
    <About
      title={aboutData.title}
      content={aboutData.content}
      stats={aboutData.stats}
    />
  )}

  {ctaData && (
    <CTA
      title={ctaData.title}
      description={ctaData.description}
      primaryCta={ctaData.primaryCta}
      secondaryCta={ctaData.secondaryCta}
      variant={ctaData.variant}
    />
  )}
</BaseLayout>
